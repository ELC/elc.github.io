<!DOCTYPE html>

<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Type-Safe Pipelines and Compose 	&#124; Ezequiel Leonardo Castaño Personal Website</title>

    <!-- Meta -->
    <meta name="name" content="Ezequiel Leonardo Castaño Personal Website">
    <meta name="description" content="Ezequiel Leonardo Castaño Personal Website - In this website you will find post about christianity, programming and math">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="image" content="https://elc.github.io/blog/images/typed-pipes/type_pipes_headerimage.png">    

    <!-- Google Verification -->
    <meta name="google-site-verification" content="UKZ1mYz9vI6xkYtBnIQL-cjCusUxX-2fKT7wdtJEdZU" />

    <!-- Social -->
      <meta property="article:author" content="Ezequiel Leonardo Castaño" />
      <meta property="article:section" content="Programming" />
      <meta property="article:published_time" content="2023-09-23" />

      <meta property="og:type" content="article"/>
      <meta property="og:title" content="Type-Safe Pipelines and Compose"/>
      <meta property="og:description" content="When dealing with multiple transformations that run sequentially, one could leverage the compose function to create pipelines. This article shows different way to implement them in a type-safe way. All the code was written using pure Python 3.11 and MyPy 1.5.1 and PyLance v2023.9.20"/>
      <meta property="og:site_name" content="Ezequiel Leonardo Castaño Personal Website" />
      <meta property="og:url" content="https://elc.github.io/posts/typed-pipes/"/>
      <meta property="og:image" content="https://elc.github.io/blog/images/typed-pipes/type_pipes_headerimage.png"/>

      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="Type-Safe Pipelines and Compose">
      <meta name="twitter:description" content="When dealing with multiple transformations that run sequentially, one could leverage the compose function to create pipelines. This article shows different way to implement them in a type-safe way. All the code was written using pure Python 3.11 and MyPy 1.5.1 and PyLance v2023.9.20">
      <meta name="twitter:url" content="https://elc.github.io/posts/typed-pipes/">
      <meta name="twitter:image" content="https://elc.github.io/blog/images/typed-pipes/type_pipes_headerimage.png">
    

    <!-- Feed -->
      <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/ELCWEB" title="Ezequiel Leonardo Castaño Personal Website Atom Feed" />
      <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/feeds/all.atom.xml" title="Ezequiel Leonardo Castaño Personal Website Atom Feed" />

    <!-- Comments -->

      <link rel="alternate" type="application/rss+xml" href="http://elcgweb.disqus.com/latest.rss" title="Ezequiel Leonardo Castaño Personal Website Comments RSS Feed">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://elc.github.io/theme/css/style.css?v=1dc05de">

    <!-- Fonts -->
    <script src="https://use.fontawesome.com/6af5d1a69f.js" async></script>

    <!-- Localization -->
    <link rel="prefetch" type="application/l10n" href="https://elc.github.io/localization.ini" />

    <!-- FAVICON -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://elc.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://elc.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://elc.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://elc.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://elc.github.io/safari-pinned-tab.svg" color="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#ffffff">

    
  </head>

  <body>

    <a id="topbar"></a>

<nav class="nav-bar">
    <h1><a href="https://elc.github.io" class="logo" title="Home">EL</a></h1>
    <input class="nav-menu-btn" type="checkbox" id="nav-menu-btn" />
    <label class="nav-menu-icon" for="nav-menu-btn"><span class="nav-icon"></span></label>
    <ul class="nav-menu">
        <li class="nav-menu__entry" ><a href="https://elc.github.io">Home</a></li>
                <li class="nav-menu__entry" ><a href="https://elc.github.io/about/" data-l10n-id="about">about</a></li>
                <li class="nav-menu__entry" ><a href="https://elc.github.io/projects/" data-l10n-id="portfolio">portfolio</a></li>
                <li class="nav-menu__entry" ><a href="https://elc.github.io/publications.html" data-l10n-id="publications">publications</a></li>
    </ul>
</nav>
<div class="nav-separator"></div>
  
    <aside class="ethical">
    <div>
      <div data-ea-keywords=Python|Types|Pipelines></div>
    </div>
    </aside>



<article class="article">

  <header class="article__header">
    <h1>Type-Safe Pipelines and Compose</h1>
    
<div class="article__subheader">

    <!-- Metadata -->
    <div class="article__metadata">
        <div class="article__metadata-item">
            <time datetime="2023-09-23 00:00:00-03:00"><b>23 Sep 2023</b></time>
        </div>
    
        <!-- Time to Read -->
            <div class="article__metadata-item">
                <b>13 min <span data-l10n-id="to-read">to read</span></b>
            </div>
            
    </div>

</div>

<!-- Translations -->
<div class="article__translations">


    
</div>  </header>


  <section>
    <p><a class="gallery" href="/blog/images/typed-pipes/type_pipes_headerimage.png"><img alt="Typed Pipes in Python" class="b-lazy" data-src="/blog/images/typed-pipes/type_pipes_headerimage.png" src="https://elc.github.io/blog/images/typed-pipes/type_pipes_headerimage-thumbnail.png" width="1683"></a></p>


<p>When dealing with multiple transformations that run sequentially, one could
leverage the compose function to create pipelines. This article shows different
way to implement them in a type-safe way. All the code was written using pure
Python 3.11 and MyPy 1.5.1 and PyLance v2023.9.20</p>


<h2 id="function-composition"><a class="toclink" href="#function-composition">Function Composition</a></h2>
<p>There are two notations for function composition one with a right-to-left
direction and one with a left-to-right direction. Namely:</p>
<p>Right to left:</p>
<div class="math">$$f∘g = f(g(x))$$</div>
<p>Left to right:</p>
<div class="math">$$f∘g = g(f(x))$$</div>
<p>The traditional notation in math is the right-to-left one. Some languages like
Haskell has built-in syntax for both. In Haskell the usual way to do composition
is with <code>.</code> which is right-to-left, it is also possible to use <code>&gt;&gt;&gt;</code> for
left-to-right composition. </p>
<p>On the other hand, one of the most common ways to compose functions in
programming is through Unix Pipes which use the <code>|</code> operator, which conversely
is left-to-right composition.</p>
<p>That means that when implementing a <code>compose</code> or a <code>pipe</code> function is not
trivial which orientation to choose as they are competing notations. In the
context of programming the left to right orientation is more common.</p>
<p>All the examples here will use the left-to-right orientation.</p>
<h2 id="the-compose-function"><a class="toclink" href="#the-compose-function">The compose function</a></h2>
<p>The compose function is a function that takes two functions <code>f</code> and <code>g</code> and
returns a new function that performs <code>g</code> and then <code>f</code>. In Python, a generic
implementation looks like this:</p>
<div class="highlight "><pre><span></span><code><span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>For this to work, it is necessary that the output of <code>f</code> matches the input of
<code>g</code>, or otherwise the execution may fail. To enforce this relationship a typed
version of the composed can be written as follows:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">g</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">U</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>This implementation uses Python 3.10's <code>ParamSpec</code>, which allows typing <code>*args</code>
and <code>**kwargs</code>.</p>
<p>Having a typed version is important as one typical case is composing multiple
functions and if the types are not enforced, unexpected behavior could arise.</p>
<p>One example of using this compose implementation is the following:</p>
<div class="highlight "><pre><span></span><code><span class="k">def</span> <span class="nf">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">composed_functions</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">convert_to_string</span><span class="p">)</span>
</code></pre></div>

<p>When using the typed version, both MyPy and Pyright can infer the resulting type:</p>
<p>Pyright (through Pylance)</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_pylance.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/compose_pylance.png" src="https://elc.github.io/blog/images/typed-pipes/compose_pylance-thumbnail.png" width="870"></a></p>
<p>MyPy</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_mypy.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/compose_mypy.png" src="https://elc.github.io/blog/images/typed-pipes/compose_mypy-thumbnail.png" width="1070"></a></p>
<p>One important aspect of function composition is that it is not commutative, that
is </p>
<div class="math">$$f∘g \neq g∘f$$</div>
<p>. There may be cases where both are equivalent but most of
the time it is not.</p>
<p>This is helpful when programming as the IDE can automatically detect and flag
types' incompatibility. Take for example trying to <code>add_one</code> to the result of
<code>convert_to_string</code>.</p>
<div class="highlight "><pre><span></span><code><span class="n">composed_incorrect</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">,</span> <span class="n">add_one</span><span class="p">)</span>
</code></pre></div>

<p>Pyright (through Pylance)</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_pylance_error.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/compose_pylance_error.png" src="https://elc.github.io/blog/images/typed-pipes/compose_pylance_error-thumbnail.png" width="771"></a></p>
<p>MyPy</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_mypy_error.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/compose_mypy_error.png" src="https://elc.github.io/blog/images/typed-pipes/compose_mypy_error-thumbnail.png" width="926"></a></p>
<p>The error from MyPy may not be descriptive enough but it at least points in the
right direction. Pyright can identify the exact cause of the problem:
<code>add_one</code> takes an <code>int</code> but it receives an <code>str</code> as the output of
<code>convert_to_string</code>.</p>
<h2 id="extension-to-multiple-functions"><a class="toclink" href="#extension-to-multiple-functions">Extension to multiple functions</a></h2>
<p>With that generic <code>compose</code> function, it is possible to compose any number of
functions, however, the syntax is a little convoluted. These are the three
sample functions to compose, one is <code>int</code> to <code>int</code>, another one is <code>int</code> to
<code>str</code> and the last one is <code>str</code> to <code>str</code>, it is also interesting to use built-in
functions such as <code>len</code> and <code>str</code> instead of user-defined ones.</p>
<div class="highlight "><pre><span></span><code><span class="k">def</span> <span class="nf">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sort_characters</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div>

<p>The composition of interest is the one that would be equivalent to doing:</p>
<div class="highlight "><pre><span></span><code><span class="k">def</span> <span class="nf">user_defined_composition</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">(</span><span class="n">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">)))))</span>
</code></pre></div>

<p>It is valid Python to create a function like that, but, it is difficult to read
and to change since the "application order" as well as the final "type mapping"
is hardcoded. Any variation would require a different signature and invocation
order.</p>
<p>To leverage the generic <code>compose</code>, one alternative would be to write:</p>
<div class="highlight "><pre><span></span><code><span class="n">user_defined_composition</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
    <span class="n">compose</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">convert_to_string</span><span class="p">),</span> <span class="n">sort_characters</span><span class="p">),</span> <span class="nb">len</span><span class="p">),</span> <span class="nb">str</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>Or equivalently:</p>
<div class="highlight "><pre><span></span><code><span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">compose</span><span class="p">(</span>
        <span class="n">compose</span><span class="p">(</span>
            <span class="n">compose</span><span class="p">(</span>
                <span class="n">compose</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">convert_to_string</span><span class="p">),</span>
                <span class="n">sort_characters</span>
            <span class="p">),</span>
            <span class="nb">len</span>
        <span class="p">),</span>
        <span class="nb">str</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p><strong>Note</strong>: both approaches are valid and threw no errors when scanned with MyPy,
nevertheless, Pyright is not able to fully detect the types.</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_test_pyright_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/compose_test_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/compose_test_pyright_types-thumbnail.png" width="795"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_test_pyright_problems.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/compose_test_pyright_problems.png" src="https://elc.github.io/blog/images/typed-pipes/compose_test_pyright_problems-thumbnail.png" width="1095"></a></p>
<p>MyPy:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/compose_test_mypy_type.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/compose_test_mypy_type.png" src="https://elc.github.io/blog/images/typed-pipes/compose_test_mypy_type-thumbnail.png" width="1072"></a></p>
<p>Neither of the previous is any easier to read than the original one. Some
languages do have a compact syntax for this use case. Haskell's <code>.</code> is an
example of clear and concise syntax (Haskell has right to left application):</p>
<div class="highlight "><pre><span></span><code><span class="nf">user_defined_composition</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">sort_characters</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">convert_to_string</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">add_one</span><span class="w"></span>
</code></pre></div>

<p>This by no means implies that Python is not a good fit for composing functions,
it just lacks built-in syntax to make it more approachable. Even though the
previous example would work without issues, in the following sections easier and
more practical alternatives will be introduced.</p>
<h2 id="naive-iterative-pipe"><a class="toclink" href="#naive-iterative-pipe">Naive Iterative Pipe</a></h2>
<p>The simplest evolution of <code>compose</code> to multiple functions in a cleaner way would
be to wrap it in a for-loop:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>

<span class="k">def</span> <span class="nf">pipe_iterative</span><span class="p">(</span><span class="o">*</span><span class="n">functions</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">composed_function</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">functions</span>
    <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">rest</span><span class="p">:</span>
        <span class="n">composed_function</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">composed_function</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">composed_function</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="n">pipe_iterative</span><span class="p">(</span>
    <span class="n">add_one</span><span class="p">,</span>
    <span class="n">convert_to_string</span><span class="p">,</span>
    <span class="n">sort_characters</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">,</span>
    <span class="nb">str</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>This approach, albeit it will work, loses all the type information.</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_pyright_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_iterative_test_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_pyright_types-thumbnail.png" width="691"></a></p>
<p>MyPy:
<a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_mypy_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_iterative_test_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_mypy_types-thumbnail.png" width="825"></a></p>
<p>At the moment, it is not possible to type <code>*functions</code> so that Python infers
that each of the functions will have an output type that will match the next
functions's input type.</p>
<p>It is possible though to type the <code>pipe_iterative</code> function if we assume that
all input and output types will be the same:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pipe_iterative</span><span class="p">(</span><span class="o">*</span><span class="n">functions</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
    <span class="o">...</span>
</code></pre></div>

<p>This signature is only applicable to a small subset of the possible function
compositions and will throw several errors with the functions used in the
previous examples.</p>
<p>Pyright:</p>
<p>In this case, the types are compatible with the <code>pipe_iterative</code> signature but
are not what the function will expect.</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_types-thumbnail.png" width="707"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_problems.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_problems.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_same_type_pyright_problems-thumbnail.png" width="938"></a></p>
<p>MyPy</p>
<p>MyPy detects the conflicting types and assumes <code>Any</code> will be the input and
output types.</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_types-thumbnail.png" width="1074"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_problems.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_problems.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_iterative_test_same_type_mypy_problems-thumbnail.png" width="924"></a></p>
<p>Disagreeing two typing tools like this may be misleading and can cause issues
down the line. Pylance's error message is much more detailed and helpful in this
instance.</p>
<p>If this type of composition is required though, there is a cleaner way of using
the <code>functools</code> module.</p>
<h2 id="reduced-pipe"><a class="toclink" href="#reduced-pipe">Reduced Pipe</a></h2>
<p>When a function takes an input type <code>T</code>, returns the same type, and has one
identity element, it is said to be a <em>Monoid</em>. It is a common word in the
Functional Programming jargon. The last signature of <code>pipe_iterative</code> follows
this pattern since it always keeps its outputs and inputs within the type <code>T</code>.</p>
<p><strong>Note</strong>: The definition of a <em>Monoid</em> includes the identity element, since
pipes operate over functions, the identity element is a function that can be
composed without altering the result. This is trivially doable in Python:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div>

<p>There is a function that achieves the same and is built-in, the
<code>functools.reduce</code>. The pipe function can then be rewritten as follows:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>

<span class="k">def</span> <span class="nf">pipe</span><span class="p">(</span><span class="o">*</span><span class="n">functions</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">compose</span><span class="p">,</span> <span class="n">functions</span><span class="p">)</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span>
    <span class="n">add_one</span><span class="p">,</span>
    <span class="n">convert_to_string</span><span class="p">,</span>
    <span class="n">sort_characters</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">,</span>
    <span class="nb">str</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>The same considerations could be made about the signature, this implementation
can either be type-safe and only operate on a single type <code>T</code> or it could be
used more generically as the previous <code>pipe_iterative</code> while losing type
information.</p>
<p>Since the signature is the same, MyPy and Pyright show the same messages.</p>
<p>There is a way to circumvent this issue and that is through the use of
<code>Generic</code>s. Where types become an additional parameter. In Python, <code>Generic</code>s
can only be used in classes, therefore the next sections will migrate to an
object-oriented programming style.</p>
<h2 id="why-types-matter"><a class="toclink" href="#why-types-matter">Why Types matter</a></h2>
<p>If the previous is a working implementation, why bother with adding types? There
is a rising number of articles and online material arguing in favor of adding
types. A summary could be the following.</p>
<p>Reasons to add types:</p>
<ul>
<li>Typed code produces fewer bugs</li>
<li>Typed code enables enforcement of input and output compatibility </li>
<li>Typed code can be checked statically, i.e. without running the code</li>
<li>Typed code is easier to test comprehensively</li>
<li>Typed code is easier to validate. See Pydantic for example</li>
<li>Typed code is less ambiguous</li>
</ul>
<p>There are also some reasons not to add types, namely:</p>
<ul>
<li>Types make the code more verbose</li>
<li>Types make the learning curve for a codebase steeper</li>
<li><strike>Types are not supported in all versions</strike>. All stable versions support types
  (3.8+).</li>
<li><strike>Some Type constructs, like ParamSpec are not available in old versions</strike>.
  Use <code>typing_extensions</code> if something is not supported</li>
</ul>
<p>And it is also important to clarify some myths</p>
<ul>
<li>Types will not make the code slower, they are ignored at runtime</li>
<li>Types are not checked at runtime, they are just used by tools like IDEs and
  Linters</li>
</ul>
<h2 id="eager-monoidal-pipe"><a class="toclink" href="#eager-monoidal-pipe">Eager Monoidal Pipe</a></h2>
<p>Before diving too deep into different alternatives, the first step would be to
replicate what the previous <code>pipe</code> function achieved but now supporting
different types.</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PipeEagerSameType</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">then</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PipeEagerSameType</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipeEagerSameType</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>The implementation is straightforward, the class stores the initial value <code>x</code>,
and then when <code>then</code> is called, that value is transformed and saved. This method
returns <code>self</code> to provide a 
<a href="https://en.wikipedia.org/wiki/Fluent_interface" target="_blank"><strong>Fluent Interface</strong></a>.
that makes the code easier to read. </p>
<p>The result at the end could be obtained by either calling the instance and thus
executing <code>__call__</code> or by simply accessing <code>x</code>. The former approach makes the
instance behave like a function and the latter like a plain object.</p>
<p>This first implementation using object-oriented programming produces similar yet
different messages from both Pyright and MyPy:</p>
<p>Pyright:</p>
<p>The errors are analogous to the implementation using <code>reduce</code>.</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_same_type_pyright_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_eager_same_type_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_same_type_pyright_types-thumbnail.png" width="793"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_same_type_pyright_problems.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_eager_same_type_pyright_problems.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_same_type_pyright_problems-thumbnail.png" width="679"></a></p>
<p>MyPy:</p>
<p>This time the errors are much more descriptive and resemble those produced by
Pyright.</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_same_type_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_eager_same_type_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_same_type_mypy_types-thumbnail.png" width="1064"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_same_type_mypy_problems.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_eager_same_type_mypy_problems.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_same_type_mypy_problems-thumbnail.png" width="1357"></a></p>
<p>Now, whenever we inspect the type, both pyright and Mypy will output the class
name and the type will be encoded in the <code>Generic</code>, i.e. the type now is
<code>PipeEagerSameType[int]</code> and it is the <code>[int]</code> part which tells the actual type.
In this case, it is the final return type which is inaccurate because the
assumption that all functions return the same type and the first one returns
<code>int</code>.</p>
<p>The next step would be to try to keep the same easy-to-read syntax while at the
same time being able to pass functions with different signatures.</p>
<p>The <code>Eager</code> in the class name is no coincidence, the previous examples using
<code>compose</code> were not eagerly evaluated, they had a lazy evaluation strategy. This
implementation though transforms the value at each step. In the case of lazy
evaluation, all the transformations are defined first and evaluated only at the
end. Lazy implementations for this Pipe class will be introduced later on.</p>
<h2 id="eager-multitype-pipe"><a class="toclink" href="#eager-multitype-pipe">Eager Multitype Pipe</a></h2>
<p>Due to the way <code>Generic</code>s work, each instance can only hold a reference to a
single type <code>T</code>. To support multiple types there are two possible solutions,
either use as many <code>TypeVar</code>s as types needed or use as many instances as types
needed. The latter is more straightforward. The implementation looks like the
following:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PipeEager</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">then</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PipeEager</span><span class="p">[</span><span class="n">U</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">PipeEager</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipeEager</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>This time, instead of returning <code>self</code>, a new instance is created, with the
updated value. Each instance now has information on the current step (through
<code>T</code>), and the following step (through <code>U</code>). The following step is not defined at
instantiation and therefore it is not needed to add <code>U</code> to the <code>Generic</code>.</p>
<p>From the outside, the API is preserved, with the additional support for
functions with different types.</p>
<p>Both Pyright and MyPy reflect types are properly inferred:</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_pyright_types.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/pipe_eager_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_pyright_types-thumbnail.png" width="858"></a></p>
<p>MyPy:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_eager_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_eager_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_eager_mypy_types-thumbnail.png" width="1019"></a></p>
<p>Now, with a compatible implementation, the type has become <code>PipeEager[str]</code>,
correctly inferring that calling the instance will return a <code>str</code> object.</p>
<p>The next step is to make a Lazy implementation resemble the first ones built
with <code>compose</code>.</p>
<h2 id="lazy-pipe-with-start"><a class="toclink" href="#lazy-pipe-with-start">Lazy Pipe with Start</a></h2>
<p>To make a lazy implementation, the value should not be stored and
transformed, it will be provided last. Therefore what needs to be stored and
mapped are the transformations.</p>
<p>To achieve this, a similar approach to the Eager classes can be used, but
replacing the value <code>x</code> with a function <code>f</code>:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PipeLazyWithStart</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span>
    <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">then</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PipeLazyWithStart</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">U</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">PipeLazyWithStart</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipeLazyWithStart</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>In this case, rather than applying a transformation to the value and storing the
transformed result, an instance is created with a new transformation which is
the current and the next one composed. This allows the creation of new instances
each composing on the previous ones.</p>
<p>The API is kept somewhat similar, it now resembles the approach with
<code>pipe_iterative</code>, where all the functions are passed first and then evaluated on
a particular value.</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_lazy_with_start_pyright_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_lazy_with_start_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_lazy_with_start_pyright_types-thumbnail.png" width="1143"></a></p>
<p>MyPy:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_lazy_with_start_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_lazy_with_start_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_lazy_with_start_mypy_types-thumbnail.png" width="1445"></a></p>
<p>With the lazy implementation, the types have changed slightly, now the type is
<code>PipeLazyWithStart[(x: int), str]</code>, which means that it takes a single parameter
called <code>x</code> of type <code>int</code> and returns a single value of type <code>str</code>. The <code>x</code> name
comes from the instance variable with the same name in the class.</p>
<p>In case the advantages of lazy evaluation are unclear, one of the following
sections will explain the pros and cons succinctly.</p>
<p>The next step would be to simplify the class so that it can be instantiated
without an initial function, this could be helpful for many reasons, one example
is testing.</p>
<h2 id="lazy-pipe"><a class="toclink" href="#lazy-pipe">Lazy Pipe</a></h2>
<p>To remove the initial function, the first impression would be to mark <code>f</code> as
<code>Optional</code>, however,  has lots of caveats, and MyPy and Pyright will complain. A
simple alternative is to create a helper class that surrogates the initial
creation of the LazyPipeline.</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PipeLazy</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="nf">then</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PipeLazyWithStart</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">PipeLazyWithStart</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipeLazy</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]()</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">convert_to_string</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>This modification makes the implementation easily generalizable, being able to
pass yet uninstantiated pipelines down the line. It also forces the user to
specify the first input and output types of a given pipeline rather than
infering it which could help prevent bugs as things are more explicit now.</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_lazy_pyright_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_lazy_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_lazy_pyright_types-thumbnail.png" width="1095"></a></p>
<p>MyPy:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/pipe_lazy_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/pipe_lazy_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/pipe_lazy_mypy_types-thumbnail.png" width="1398"></a></p>
<p>Now the type is identical to the previous one but without specifying the <code>x</code>,
that is because, at the moment of instantiation, the <code>PipeLazy</code> object takes no
arguments. And even after being initialized with <code>[[int], int]</code> it accurately
updated the return type to <code>str</code> by following the chain of compositions.</p>
<p>So far this implementation checks all the boxes, however, there is yet another
way to implement similar behavior leveraging less common Python features. The
next section will evolve this implementation to add support for decorators and
operator overloading.</p>
<h2 id="composable-objects"><a class="toclink" href="#composable-objects">Composable Objects</a></h2>
<p>This section is kept to showcase some of the features of the language, but it
may result in code that is harder to read.</p>
<p>Classes as decorators is an intermediate-advanced concept in Python, in fact,
<code>PipeLazyWithStart</code> can already be used as a decorator since it only takes <code>f</code>
which is a function.</p>
<p>The other feature of the language that can be used is operator overloading, in
this case, the <code>&gt;&gt;</code> operator (also known as right shift) which resembles the
<code>&gt;&gt;&gt;</code> in Haskell for left-to-right composition. Other valid alternatives could
have been the <code>|</code> or the <code>&amp;</code> (bitwise or and bitwise and respectively). Python
does not support the definition of custom operators so having a new <code>&gt;&gt;&gt;</code>
operator is not feasible.</p>
<p>To overload the <code>&gt;&gt;</code> operator one needs to define a <code>__rshift__</code> method, which
in this case will have the same functionality as the <code>then</code> method. The only
difference would be that it would need to handle functions and objects of the
same class.</p>
<p>The implementation looks like the following:</p>
<div class="highlight "><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Composable</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span>
    <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Composable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">U</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Composable</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">Composable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Composable</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nd">@Composable</span>
<span class="k">def</span> <span class="nf">convert_to_string_decorated</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">user_defined_composition</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Composable</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">convert_to_string_decorated</span>
    <span class="o">&gt;&gt;</span> <span class="n">Composable</span><span class="p">(</span><span class="n">sort_characters</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="nb">len</span>
    <span class="o">&gt;&gt;</span> <span class="nb">str</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">user_defined_composition</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</code></pre></div>

<p>The resulting syntax with <code>&gt;&gt;</code> is something <em>new</em>, in some cases, like when
building a framework or an SDK, introducing new syntax like this could have
great benefit. One project that does this is Apache Airflow. However, most often
it results in niche uses that, without proper documentation could make the code
harder to read and maintain.</p>
<p>Pyright:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/composable_pyright_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/composable_pyright_types.png" src="https://elc.github.io/blog/images/typed-pipes/composable_pyright_types-thumbnail.png" width="1033"></a></p>
<p>MyPy:</p>
<p><a class="gallery" href="/blog/images/typed-pipes/composable_mypy_types.png"><img alt="Alt Text" class="b-lazy" data-src="/blog/images/typed-pipes/composable_mypy_types.png" src="https://elc.github.io/blog/images/typed-pipes/composable_mypy_types-thumbnail.png" width="1174"></a></p>
<p><a class="gallery" href="/blog/images/typed-pipes/composable_mypy_problems.png"><img alt="Alt Text" class="b-lazy narrow" data-src="/blog/images/typed-pipes/composable_mypy_problems.png" src="https://elc.github.io/blog/images/typed-pipes/composable_mypy_problems-thumbnail.png" width="787"></a></p>
<p>The types are identical to those of <code>PipeLazyWithStart</code>, however, Mypy complains
about not being able to infer the type of the first parameter of <code>compose</code>,
which is unexpected. This may have been due to the interaction between
<code>ParamSpec</code>s and <code>TypeVars</code> in an edge case.</p>
<h2 id="why-does-lazy-evaluation-matter"><a class="toclink" href="#why-does-lazy-evaluation-matter">Why does Lazy Evaluation matter?</a></h2>
<p>Eager vs. Lazy evaluation is a topic that would deserve an article on its own.
There are tools like <code>polars</code> and <code>pandas</code> that use eager evaluation and at the
same time other tools like <code>pyspark</code> use lazy evaluation.</p>
<p>The following are some key questions to help decide which is better for each
case:</p>
<ul>
<li>Speed - Either</li>
<li>Easy to read code - Either</li>
<li>Easy to test code - Either</li>
<li>Easy to debug code / interactive programming - Eager</li>
<li>Optimized transformations - Lazy</li>
<li>Flexibility - Lazy</li>
<li>Separation of transformations from data - Lazy</li>
</ul>
<h2 id="conclusion"><a class="toclink" href="#conclusion">Conclusion</a></h2>
<p>There are scenarios where certain operations need to be applied sequentially,
that is a hint for the pipeline pattern which can be implemented with either an
Eager or a Lazy evaluation approach.</p>
<p>Knowing when to use which depends on the scenario but the key aspect is to
structure the code so that the final result is easy to read, easy to test and
easy to maintain.</p>
<p>On a personal note, I believe that unless required, the LazyPipe would suffice
most of the time, and in case it doesn't switching to the Eager version is a
minor change that should not introduce any breaks down the line.</p>
<p>If dealing with a lot of error handling, these pipelines could be combined with
Railway Oriented Programming to streamline processes end to end.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (true) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </section>


  <footer>

<!-- Previous And Next Articles -->
<section class="invisible">
    <h2 data-l10n-id="previous-next">Do not forget to check the previous and next Articles</h2>
        <a class="article__button" href="https://elc.github.io/posts/angel">ANGEL - An Oppinionated Guide on how to Learn Programming (focusing on Python)</a>
</section>

<!-- Share -->
<section>
    <h2 class="share-invitation"><span data-l10n-id="share-invitation">Did you like this article? Share it!</span></h2>

    <div class="share">
        

        <a href="http://twitter.com/share?url=https%3A//elc.github.io/posts/typed-pipes&amp;text=%40ELCWeb%20wrote%20this%20interesting%20article%3A%20Type-Safe%20Pipelines%20and%20Compose" target="_blank" class="twitter-button"
        onclick="ga('send', 'event', 'Twitter Share', 'click', 'Twitter Share'); return true" >
            <i class="fa fa-twitter"></i>
            Twitter
        </a>

        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//elc.github.io/posts/typed-pipes&amp;text=%40ELCWeb%20wrote%20this%20interesting%20article%3A%20Type-Safe%20Pipelines%20and%20Compose" target="_blank" class="linkedin-button"
        onclick="ga('send', 'event', 'LinkedIn Share', 'click', 'LinkedIn Share'); return true" >
            <i class="fa fa-linkedin"></i>
            LinkedIn
        </a>
    </div>
</section>

<!-- Contribution -->
<section>
    <div class="share">
        <a target="_blank" class="contribute-button" 
        href='https://github.com/ELC/elc.github.io-content/edit/master/blog/2023-typed-pipes.md'
        onclick="ga('send', 'event', 'Contribution', 'click', 'Article Contribution'); return true" 
        data-l10n-id="colaboration-button">
        Found a bug or typo? Submit a PR!
        </a>
    </div>
</section>


<!-- News Letter Subscription -->

<ul class="newsletter-container">
    <li>
        <input class="newsletter-check" type="radio" name="ac" id="a1" />
        <label for="a1" class="newsletter-button" data-l10n-id="newsletter-button">Get notify when a new article is published! Subscribe to the Newsletter</label>
        <section class="newsletter-content">
            <h2>
                <span data-l10n-id="subscribe-options">You can subscribe to the news feed via</span><strong> Feedly </strong>
                <span data-l10n-id="or">or</span><strong> Email</strong>:
            </h2>

            <div class="share">
                <a href='https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FELCWEB' target='blank'
                    onclick="ga('send', 'event', 'Feedly Subscribe Button', 'click', 'Newsletter'); return true">
                    <img id='feedlyFollow' src='http://s3.feedly.com/img/follows/feedly-follow-rectangle-flat-big_2x.png' alt='follow us in feedly' width='131' height='56'>
                </a>

                <a class="newsletter-button" target="popupwindow" href="https://feedburner.google.com/fb/a/mailverify?uri=ELCWEB"
                    onclick="window.open('https://feedburner.google.com/fb/a/mailverify?uri=ELCWEB', 'popupwindow', 'scrollbars=yes,width=550,height=450'); ga('send', 'event', 'Email Subscribe Button', 'click', 'Newsletter'); return true" >
                    <i class="fa fa-envelope"></i>
                    Email
                </a>
            </div>
            
            <p>
                <span data-l10n-id="newsletter-feedburner">In case you use another reader, check the full list in the </span>
                <a href="http://feeds.feedburner.com/ELCWEB" target="_blank">FeedBurner Pages</a>
            </p>

        </section>
    </li>
</ul>

<!-- Related Posts -->
<section class="article-related">
    <h2 class="article-related-title" data-l10n-id="related-posts">Related Posts</h2>
        <article class="article-related-post">
                    <a class="article-related-post-link" href="https://elc.github.io/posts/angel" aria-label="Related Post">
                        <img alt="Related Article Header Image" class="b-lazy article-related-post-link-img" data-src="https://elc.github.io/blog/images/angel-guide/angel-guide-headerimage.png" src="https://elc.github.io/blog/images/angel-guide/angel-guide-headerimage-thumbnail.png">
                    </a>
          
            <div class="article-related-post-body">
                <h3 class="article-related-post-body-title"><a href="https://elc.github.io/posts/angel">ANGEL - An Oppinionated Guide on how to Learn Programming (focusing on Python)</a></h3>
                
                <p class="article-related-post-body-description">Courses and pieces of training claiming to deliver rapid results have become increasingly popular these days. Nonetheless, amidst the abundance of online resources, it can be challenging to distinguish valuable ones from the noise. Enter ANGEL, which stands for "ANGEL's Not a Guide to Effortlessly Learning." This guide presents readers with a practical approach to the programming learning experience. While the examples will be specific to Python, the reader can apply the core content to any programming language or framework.</p>
            </div>
        </article>
        <article class="article-related-post">
                    <a class="article-related-post-link" href="https://elc.github.io/posts/recursion-python" aria-label="Related Post">
                        <img alt="Related Article Header Image" class="b-lazy article-related-post-link-img" data-src="https://elc.github.io/blog/images/recursion/recursive-python_headerimage.png" src="https://elc.github.io/blog/images/recursion/recursive-python_headerimage-thumbnail.png">
                    </a>
          
            <div class="article-related-post-body">
                <h3 class="article-related-post-body-title"><a href="https://elc.github.io/posts/recursion-python">Python Recursion: a Trampoline from the Mutual Head to the Memoized Nested Tail</a></h3>
                
                <p class="article-related-post-body-description">Recursion is a key concept of programming. However, it is usually only superficially explored. There are different ways of having recursion, this post will illustrate them using Python examples, call graphs and step-by-step runs. Including cases of head, tail, nested and mutual recursion. For each case, the call graph will be shown.</p>
            </div>
        </article>
        <article class="article-related-post">
                    <a class="article-related-post-link" href="https://elc.github.io/posts/streamlit-google-analytics" aria-label="Related Post">
                        <img alt="Related Article Header Image" class="b-lazy article-related-post-link-img" data-src="https://elc.github.io/blog/images/streamlit-google-analytics/streamlit-google-analytics_headerimage.png" src="https://elc.github.io/blog/images/streamlit-google-analytics/streamlit-google-analytics_headerimage-thumbnail.png">
                    </a>
          
            <div class="article-related-post-body">
                <h3 class="article-related-post-body-title"><a href="https://elc.github.io/posts/streamlit-google-analytics">Add Google Analytics (or any custom HTML) to Streamlit with Github Pages</a></h3>
                
                <p class="article-related-post-body-description">Streamlit is one of the most popular libraries for creating web apps using Python, and they also provide a service to freely host and share your apps. One of the issues with this free sharing capability is that one losses control over the app, for instance, it is no longer possible to control how the precise HTML will look like or add custom Open Graph or analytics. This post shows a simple and easy way to add all of this by using Github Pages.</p>
            </div>
        </article>
</section>

    <!-- Comments -->

  <script src="https://utteranc.es/client.js"
          repo="elc/elc.github.io-content"
          issue-term="title"
          label="Comment"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>
  <!-- <div id="disqus_thread"></div>
  <script>    
    var disqus_config = function () {
      this.page.url = 'https://elc.github.io/posts/typed-pipes';  
      this.page.identifier = 'typed-pipes';
      this.page.title = 'Type-Safe Pipelines and Compose';
    };
    
    (function() {
      var d = document, s = d.createElement('script');
      
      s.src = 'https://elcgweb.disqus.com/embed.js';
      
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> -->
  </footer>

</article>


<footer class="footer">
    <div class="footer-container">
        <ul class="footer-container__column">
                <li><a href="https://elc.github.io/about/" data-l10n-id="about">About</a></li>
                <li><a href="https://elc.github.io/projects/" data-l10n-id="portfolio">Portfolio</a></li>
                <li><a href="https://elc.github.io/publications.html" data-l10n-id="publications">Publications</a></li>
        </ul>
        <ul class="footer-container__column">
            <li><a href="https://elc.github.io/categories/" data-l10n-id="categories">Categories</a></li>
            <li><a href="https://elc.github.io/tags/" data-l10n-id="tags">Tags</a></li>
        </ul>
        <ul class="footer-container__column">
            <li><a href="https://elc.github.io/archives/" data-l10n-id="archives">Archive</a></li>
 
                    <li><a href="https://elc.github.io/disclaimer.html" data-l10n-id="disclaimer">Disclaimer</a></li>
 
                    <li><a href="https://elc.github.io/donate.html" data-l10n-id="donate">Donate</a></li>
        </ul>
    </div>
    <div class="copyright">
        <span>&copy; 2023 Ezequiel Leonardo Castaño</span>
        <span>  <a href="http://feeds.feedburner.com/ELCWEB">Atom feed <i class="fa fa-rss" aria-hidden="true"></i></a></span>
    </div>
</footer>
    <a href="#topbar" class="back-to-top" aria-label="Back to Top">
      <i class="fa fa-arrow-up"></i>
    </a>

    <script src="https://elc.github.io/theme/js/scripts.js?v=df4f0b1" ></script>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3GBPLEV2K"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-Y3GBPLEV2K');
</script>


<script id="dsq-count-scr" src="https://elcgweb.disqus.com/count.js" async></script>

<script>

  var options = {
    sourceAttribute: "src",
    showCloseButton: true
  };

  new LuminousGallery(document.querySelectorAll(".gallery"), options);
</script>

      <script>
        var omitAds = false;
        if (!omitAds){
          
          let dataType = "text";
          let cssClasses = [];
          let adPosition = "";
          let adOrientation = "";
          
          if (window.matchMedia("(min-width: 1500px)").matches) {
            dataType = "image"
              
            const position = ["fixed", "absolute"];
            const randomPosition = Math.floor(Math.random() * position.length);
            adPosition = position[randomPosition]
            cssClasses.push(`ethical-image--${adPosition}`)
            
            const orientations = ["left", "right"];
            const randomOrientation = Math.floor(Math.random() * orientations.length);
            adOrientation = orientations[randomOrientation]
            cssClasses.push(`ethical-image--${adOrientation}`)
              
            }
            
          let ethicalAd = document.querySelector('[data-ea-keywords]');
          
          ethicalAd.setAttribute("data-ea-publisher", "elcgithubio");
          ethicalAd.setAttribute("data-ea-type", dataType);
          ethicalAd.setAttribute("id", `${dataType}-${adPosition}-${adOrientation}`);
          ethicalAd.parentElement.classList.add(`ethical-${dataType}`)
          ethicalAd.parentElement.classList.add(...cssClasses)

        }
      </script>
      
      <script async src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>

  </body>

</html>